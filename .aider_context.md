# ğŸ¤– Arbitrage Bot - Development Context

## ğŸ“‹ Project Status (Dec 09, 2025)

### âœ… COMPLETED
1. **Parser** - C-Sport, Nova, Saba odds parsers
2. **Event Matching** - Team name normalization & matching
3. **Arbitrage Detection** - Margin calculation & opportunity detection
4. **Backend Engine** - Node.js API (port 3000)
5. **Database** - PostgreSQL setup
6. **Redis Cache** - Session & cache
7. **Docker Setup** - Full docker-compose

### ğŸ”„ IN PROGRESS
1. **Frontend UI** - React + Tailwind (port 8080)
   - Status: Building, blank page issue debugging
   - Components: Header, Settings, Logs, Status
   - Issue: localStorage errors in components

### ğŸ“ TODO
1. Fix frontend blank page bug
2. Integrate real WebSocket for live opportunities
3. Add betting execution module
4. APIs integration
5. Production deployment

---

## ğŸ—ï¸ Architecture

sportsbook-minimal/
â”œâ”€â”€ engine/ # Node.js backend
â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”œâ”€â”€ routes/ # API endpoints
â”‚ â”‚ â”œâ”€â”€ services/ # ArbitrageService
â”‚ â”‚ â”œâ”€â”€ config/ # DB, Redis config
â”‚ â””â”€â”€ backend_engine.py # Python arbitrage engine
â”œâ”€â”€ minimal-ui/ # React frontend
â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”œâ”€â”€ components/ # 6 components
â”‚ â”‚ â””â”€â”€ App.jsx
â”‚ â””â”€â”€ dist/ # Built files
â”œâ”€â”€ worker/ # Python workers
â”‚ â”œâ”€â”€ csport_parser_final_fixed.py
â”‚ â”œâ”€â”€ event_matcher.py
â”‚ â””â”€â”€ arbitrage_detector.py
â””â”€â”€ docker-compose.yml # Full stack

---

## ğŸ”— Repositories

**Main:** `guntjong-max/arb` (GitHub)
**Frontend ref:** `guntjong-max/guntjong-max-arb` (GitHub)

---

## ğŸš€ Commands

Build frontend
cd ~/sportsbook-minimal/minimal-ui && npm run build

Start full stack
cd ~/sportsbook-minimal && docker-compose up -d

Test API
curl http://localhost:3000/health
curl -X POST http://localhost:3000/api/v1/scanner/detect -H 'Content-Type: application/json' -d '{}'

View logs
docker logs arb-engine -f
docker logs arb-ui | tail -50

SSH to server
ssh root@217.216.35.6

---

## ğŸ’» Key Files

| File | Purpose |
|------|---------|
| `engine/src/services/arbitrage.service.js` | Core arbitrage detection logic |
| `engine/src/routes/scanner.routes.js` | REST API endpoints |
| `minimal-ui/src/App.jsx` | Main React app |
| `docker-compose.yml` | Full stack config |
| `minimal-ui/nginx.conf` | SPA routing config |

---

## ğŸ› Current Issues

1. **Frontend blank page** (HIGH PRIORITY)
   - Root element rendering but no content
   - localStorage errors in console
   - Status: Debugging

2. **Component compatibility** (MEDIUM)
   - Some components from guntjong-max-arb have type errors
   - Fix: Using simplified fallback components

3. **API integration** (LOW)
   - Backend health check working
   - Real opportunities not flowing yet
   - âœ… MINIMALIST ENGINE â€” BACKEND API SPEC (FINAL & COMPLETE)
(Semua mengikuti aturan yang kamu wajibkan sebelumnya)
________________________________________
1ï¸âƒ£ API LIST (FINAL)
Semua endpoint REST untuk backend utama:
Method	Route	Fungsi
POST	/api/login	Queue login semua akun & semua provider
GET	/api/login-status	Cek status login + cookies ok/tidak
POST	/api/settings	Simpan setting UI ke backend engine
GET	/api/settings	Load setting UI (min/max %, minute filter, market filter, round off)
POST	/api/execute	Kirim instruksi bet ke backend (backend â†’ worker sequence)
GET	/api/bets	Riwayat semua bet (success / failed / cooldown)
GET	/api/system-health	Health check panel (ping ms, backend healthy lamp, worker connectivity)
________________________________________
2ï¸âƒ£ DETAILED API SPEC (Coder-Friendly)
________________________________________
âœ… 1. POST /api/login
Tujuan:
Trigger login ke white-label (QQ188)
Worker login ke masing2 provider (Nova Sport, Saba Sport, dll)
Simpan cookies/session untuk 5 menit (wajib)
Request:
{
  "accounts": [
    {
      "url": "https://qq188.com",
      "username": "user123",
      "password": "pass123"
    }
  ]
}
Response:
{
  "status": "queued",
  "message": "Login started for all workers"
}
________________________________________
âœ… 2. GET /api/login-status
Untuk UI panel login status.
Response:
{
  "workers": [
    {
      "provider": "nova",
      "status": "logged_in",
      "cookies_valid": true,
      "balance": 2200.50,
      "ping_ms": 123
    },
    {
      "provider": "saba",
      "status": "logging_in",
      "cookies_valid": false,
      "balance": null,
      "ping_ms": null
    }
  ]
}
________________________________________
âœ… 3. POST /api/settings
Menyimpan setting UI seperti:
min% max%
minute filter (HT/FT)
market filter (checkbox)
prematch/live/all
round off
Request:
{
  "min_percent": 3,
  "max_percent": 10,
  "minute_limit_ht": 35,
  "minute_limit_ft": 75,
  "market_filter": {
    "ft_hdp": true,
    "ft_ou": true,
    "ft_1x2": false,
    "ht_hdp": true,
    "ht_ou": true,
    "ht_1x2": false
  },
  "match_filter": "live_only",
  "round_off": 5
}
Response:
{
  "status": "saved"
}
________________________________________
âœ… 4. GET /api/settings
Response:
{
  "min_percent": 3,
  "max_percent": 10,
  "minute_limit_ht": 35,
  "minute_limit_ft": 75,
  "market_filter": {
    "ft_hdp": true,
    "ft_ou": true,
    "ft_1x2": false,
    "ht_hdp": true,
    "ht_ou": true,
    "ht_1x2": false
  },
  "match_filter": "live_only",
  "round_off": 5
}
________________________________________
âœ… 5. POST /api/execute
Backend akan meneruskan ke worker via WebSocket:
Aturan wajib:
Selalu bet positif odds
Setelah accept, baru kirim pair-bet
Hitungan round off: 0 atau 5
Cek cooldown 60 detik sebelum bet
Request:
{
  "pair_id": "match23230149",
  "leg_1": {
    "provider": "nova",
    "match_id": "23230149",
    "market": "full_time",
    "type": "hdp",
    "side": "home",
    "line": "-0.5",
    "odds": 0.72,
    "stake": 100
  },
  "leg_2": {
    "provider": "saba",
    "match_id": "23230149",
    "market": "full_time",
    "type": "hdp",
    "side": "away",
    "line": "+0.5",
    "odds": 0.88,
    "stake": 100
  }
}
Response:
{
  "status": "queued",
  "message": "Pair bet sent to workers"
}
________________________________________
âœ… 6. GET /api/bets
Response:
{
  "history": [
    {
      "timestamp": 1702117245,
      "pair_id": "match23230149",
      "provider": "nova",
      "match_id": "23230149",
      "market": "full_time",
      "type": "hdp",
      "side": "home",
      "stake": 100,
      "odds": 0.72,
      "result": "accepted",
      "cooldown_end": 1702117305
    }
  ]
}
________________________________________
7ï¸âƒ£ API paling penting: /api/system-health
INI YANG BELUM KAMU MASUKKAN.
Aku buatkan versi lengkap.
GET /api/system-health
Untuk UI tampilkan:
healthy lamp (backend green/yellow/red)
worker status
ping ms
websocket connectivity
Response:
{
  "backend": {
    "healthy": true,
    "uptime_seconds": 34200,
    "ws_clients": 4
  },
  "workers": [
    {
      "provider": "nova",
      "connected": true,
      "last_ping_ms": 122,
      "latency_status": "good",
      "odds_stream_active": true
    },
    {
      "provider": "saba",
      "connected": true,
      "last_ping_ms": 180,
      "latency_status": "warning",
      "odds_stream_active": true
    }
  ]
}
UI bisa bikin indikator lampu:
Kondisi	Warna
ping < 150ms	ğŸŸ¢
150â€“350ms	ğŸŸ¡
>350ms	ğŸ”´
________________________________________
8ï¸âƒ£ FLOW SCAN MINIMALIST (FINAL)
Worker:
Login â†’ Simpan cookies
Poll API 250â€“400ms
Kirim ke backend via WebSocket
Terima bet instruction
Eksekusi bet â†’ kirim result â†’ cooldown 60 detik
Backend:
Terima odds dari workers
Normalisasi team
Check filter UI
Cari arbitrage pair
Eksekusi leg-1 (positif odds)
Jika accepted â†’ kirim leg-2
Simpan history
Update cooldown masing-masing provider
________________________________________
9ï¸âƒ£ FORMAT data odds (wajib pakai)
Sangat penting agar engine minimal bisa berjalan stabil.
{
  "type": "odds_update",
  "provider": "nova",
  "matches": [
    {
      "match_id": "23230149",
      "league": "ESOCCER",
      "home_team": "Chelsea",
      "away_team": "Tottenham",
      "score": "0:0",
      "time": "1H 3",
      "status": "live",
      "odds": {
        "ft_hdp": { "home": 0.72, "away": 0.88 },
        "ft_ou": { "over": 0.98, "under": 0.65 },
        "ht_hdp": { "home": 0.95, "away": 0.70 },
        "ht_ou": { "over": 0.65, "under": 0.55 }
      }
    }
  ]
}

4.Test live arbitrage detection.



